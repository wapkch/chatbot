# ChatGPT 风格流式 Markdown 渲染器设计

## 需求总结

- **视觉风格**: ChatGPT 风格 - 简洁现代、大量留白、灰白色调、圆角卡片
- **主题支持**: 浅色/深色模式自动切换
- **代码块**: 语法高亮（Highlightr）+ 语言标签 + 复制按钮
- **数学公式**: 不需要

## 架构设计

```
SmartMarkdownRenderer (入口，保留)
    ├── StreamingMarkdownRenderer (流式，简化样式)
    └── AdvancedMarkdownRenderer (完成内容)
            ├── HeadingView (重新设计)
            ├── ParagraphView (优化行间距)
            ├── CodeBlockView (全新设计，集成 Highlightr)
            ├── InlineCodeView (新增，区分行内代码)
            ├── ListItemView (重新设计)
            ├── BlockquoteView (重新设计)
            └── DividerView (新增，支持 ---)
```

## 设计令牌

### 颜色系统

| 用途 | 浅色模式 | 深色模式 |
|------|----------|----------|
| 消息背景 | #FFFFFF | #1E1E1E |
| 代码块背景 | #F6F8FA | #282C34 |
| 代码块头部 | #E5E7EB | #343541 |
| 行内代码背景 | #E8E8E8 | #3A3A3A |
| 主文字 | #1A1A1A | #E5E5E5 |
| 次要文字 | #6B6B6B | #9A9A9A |
| 链接 | #2563EB | #2563EB |
| 引用边框 | #D1D5DB | #4B5563 |
| 分隔线 | #E5E7EB | #374151 |

### 间距系统（4px 倍数）

| 用途 | 值 |
|------|-----|
| 段落间距 | 16px |
| 标题上间距 | 24px |
| 标题下间距 | 8px |
| 代码块内边距 | 16px |
| 代码块头部内边距 | 12px 水平, 8px 垂直 |
| 列表项间距 | 8px |
| 行内代码内边距 | 6px 水平, 2px 垂直 |

### 字体系统

| 用途 | 字体 | 大小 | 行高 |
|------|------|------|------|
| 正文 | SF Pro Text | 16px | 1.6 |
| 代码 | SF Mono | 14px | 1.5 |
| 标题 H1 | SF Pro Display Bold | 24px | 1.3 |
| 标题 H2 | SF Pro Display Bold | 20px | 1.3 |
| 标题 H3 | SF Pro Display Bold | 17px | 1.3 |

## 代码块设计

### 视觉结构

```
┌─────────────────────────────────────────┐
│  swift                        [复制]    │  ← 头部栏
├─────────────────────────────────────────┤
│  func greet(name: String) {             │
│      print("Hello, \(name)!")           │  ← 代码区域
│  }                                      │
└─────────────────────────────────────────┘
```

### 功能规格

- 头部显示语言名称（小写）和复制按钮
- 使用 Highlightr 语法高亮
- 浅色模式: `github` 主题
- 深色模式: `atom-one-dark` 主题
- 长行横向滚动，不换行
- 复制成功显示 "Copied!" 反馈，2秒后恢复
- 圆角: 8px

## 其他元素设计

### 标题
- H1: 24px 加粗，上 24px 下 12px
- H2: 20px 加粗，上 20px 下 10px
- H3: 17px 加粗，上 16px 下 8px

### 行内代码
- 背景圆角 4px
- SF Mono 14px
- 内边距 6px 水平, 2px 垂直

### 引用块
- 左侧 3px 竖线
- 内容左缩进 16px
- 使用次要文字色
- 不使用斜体

### 列表
- 无序: 实心圆点 •
- 有序: 数字 + 点
- 左缩进 16px
- 项间距 8px

### 链接
- 颜色 #2563EB
- 无下划线
- 可点击打开

### 分隔线
- 1px 高度
- 上下各 16px 间距

## 流式渲染策略

1. 已完成块立即使用完整样式
2. 流式中的块使用简化样式
3. 代码块流式时纯文本显示，完成后应用高亮
4. 100ms 防抖避免频繁重渲染
5. 高度变化使用隐式动画

## 实现步骤

1. 添加 Highlightr 依赖
2. 创建 MarkdownTheme 设计令牌文件
3. 重构 CodeBlockView 组件
4. 更新其他 Markdown 元素样式
5. 优化流式渲染逻辑
6. 测试浅色/深色模式切换
